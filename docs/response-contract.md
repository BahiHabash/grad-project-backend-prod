# üìÑ Unified API Response Contract Specification

This document defines the standard JSON structure for all responses generated by the backend to ensures client applications can predict the format of every API call, simplifying error handling and data parsing.

## 1\. ‚öôÔ∏è Core Response Metadata (`IResponse`)

Every single API response, regardless of success or failure, will contain the following top-level fields:

| Field        | Type      | Description                                                                                                     | Example                      |
| :----------- | :-------- | :-------------------------------------------------------------------------------------------------------------- | :--------------------------- |
| `success`    | `boolean` | Indicates the overall outcome of the request. **`true`** for HTTP codes $2xx$; **`false`** for $4xx$ and $5xx$. | `true`                       |
| `statusCode` | `number`  | The HTTP status code returned in the response headers.                                                          | `201`                        |
| `timestamp`  | `string`  | The ISO 8601 timestamp of when the response was generated by the server.                                        | `"2025-11-25T03:07:00.000Z"` |
| `path`       | `string`  | The requested URL path (excluding query parameters).                                                            | `"/api/v1/users"`            |

---

## 2\. ‚úÖ Success Response Structure (`ISuccessResponse<T>`)

This structure is used for all successful requests (HTTP Status Codes $200$, $201$, $204$, etc.).

| Field     | Type        | Description                                                                                                                   |
| :-------- | :---------- | :---------------------------------------------------------------------------------------------------------------------------- |
| `message` | `string`    | A human-readable message, often set by the **`@ResponseMessage`** decorator.                                                  |
| `data`    | `T \| null` | The primary payload data (an object, array, or primitive). This will be explicitly **`null`** for $204$ No Content responses. |

### Example 201 (Created)

```json
{
  "success": true,
  "statusCode": 201,
  "message": "User account successfully created.",
  "timestamp": "2025-11-25T03:07:00.000Z",
  "path": "/api/v1/users",
  "data": {
    "id": "a9b3c4d5",
    "email": "test@example.com",
    "createdAt": "2025-11-25T03:07:00.000Z"
  }
}
```

### Example 204 (No Content)

```json
{
  "success": true,
  "statusCode": 204,
  "message": "Resource deleted successfully.",
  "timestamp": "2025-11-25T03:07:00.000Z",
  "path": "/api/v1/posts/123",
  "data": null
}
```

---

## 3\. ‚ùå Error Response Structure (`IErrorResponse`)

This structure is used for all error states (HTTP Status Codes $4xx$ and $5xx$).

| Field       | Type       | Description                                                                                                                                                      |
| :---------- | :--------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `errorType` | `string`   | The class name or type of the exception (e.g., `"BadRequestException"`, `"UnauthorizedException"`, `"InternalServerError"`).                                     |
| `messages`  | `string[]` | An array of human-readable error messages. This will contain one message for simple errors, or multiple messages for validation errors (from `class-validator`). |

### Example 400 (Bad Request / Validation Error)

```json
{
  "success": false,
  "statusCode": 400,
  "errorType": "BadRequestException",
  "timestamp": "2025-11-25T03:07:00.000Z",
  "path": "/api/v1/auth/register",
  "messages": [
    "Password is too weak. Must be at least 8 characters.",
    "Email field must be a valid email address."
  ]
}
```

### Example 500 (Internal Server Error)

```json
{
  "success": false,
  "statusCode": 500,
  "errorType": "InternalServerError",
  "timestamp": "2025-11-25T03:07:00.000Z",
  "path": "/api/v1/data-export",
  "messages": [
    "Internal Server Error"
    // Note: Specific error details are logged server-side, not exposed to the client.
  ]
}
```

---

# How it works

## Controller Responsibility

**"Controllers must only return the raw payload data (your DTO or entity), or throw a standard NestJS exception."**

```typescript
import { ResponseMessage } from '../common/decorators/response-message.decorator';

@Controller('users')
export class UsersController {
  // Use the decorator to set the custom message (Optional)
  @ResponseMessage('User created successfully')
  @HttpCode(201) // Use NestJS decorators for status codes (Optional)
  async create(@Body() dto: CreateUserDto): Promise<UserEntity> {
    // RETURN ONLY THE DATA.
    return this.userService.create(dto);
  }
}
```

## Interceptor and Filter Responsibility

- **`TransformResponseInterceptor`:** Automatically wraps the returned data with `success: true`, `statusCode`, `timestamp`, and the message read from the `@ResponseMessage` decorator.

- **`GlobalExceptionFilter`:** Catches all thrown exceptions (e.g., `NotFoundException`, `UnauthorizedException`) and formats them into the standard error structure (with `success: false` and the `messages` array).
